---
const toggleId = 'theme-toggle';
---
<button
  id={toggleId}
  class="flex h-10 w-10 items-center justify-center rounded-full border border-border bg-transparent text-muted transition hover:border-accent hover:text-accent"
  type="button"
  aria-label="Toggle color theme"
>
  <span class="sr-only">Toggle color theme</span>
  <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
    <circle cx="12" cy="12" r="4"></circle>
    <path d="M12 3v2" stroke-linecap="round"></path>
    <path d="M12 19v2" stroke-linecap="round"></path>
    <path d="M4.22 4.22l1.42 1.42" stroke-linecap="round"></path>
    <path d="M18.36 18.36l1.42 1.42" stroke-linecap="round"></path>
    <path d="M3 12h2" stroke-linecap="round"></path>
    <path d="M19 12h2" stroke-linecap="round"></path>
    <path d="M18.36 5.64l1.42-1.42" stroke-linecap="round"></path>
    <path d="M4.22 19.78l1.42-1.42" stroke-linecap="round"></path>
  </svg>
</button>
<script is:inline>
const toggle = document.getElementById('${toggleId}');
  const storageKey = 'chat-ollama-theme';
  const root = document.documentElement;

  const applyTheme = (theme) => {
    root.dataset.theme = theme;
    if (theme === 'dark') {
      root.dataset.colorTheme = 'dark';
    } else {
      root.dataset.colorTheme = 'light';
    }
    localStorage.setItem(storageKey, theme);
  };

  const initialize = () => {
    const stored = localStorage.getItem(storageKey);
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(stored ?? (prefersDark ? 'dark' : 'light'));
  };

  initialize();

  toggle?.addEventListener('click', () => {
    const next = root.dataset.theme === 'light' ? 'dark' : 'light';
    applyTheme(next);
  });

  const mq = window.matchMedia('(prefers-color-scheme: dark)');
  if ('addEventListener' in mq) {
    mq.addEventListener('change', (event) => {
      const stored = localStorage.getItem(storageKey);
      if (stored) return;
      applyTheme(event.matches ? 'dark' : 'light');
    });
  }
</script>
